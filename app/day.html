<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trackers for Day</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4caf50">

<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #121212;
  color: #fff;
  margin: 0;
  padding: 20px;
}
h1 { text-align:center; margin-bottom:20px; }
.card {
  background: #1e1e1e;
  padding: 15px;
  border-radius: 15px;
  margin-top: 15px;
}
.green { background: #4caf50; color:#000; padding:5px 8px; border-radius:5px; margin-bottom:5px; display:block; }
.yellow { background: #ff9800; color:#000; padding:5px 8px; border-radius:5px; margin-bottom:5px; display:block; }
.red { background: #f44336; color:#fff; padding:5px 8px; border-radius:5px; margin-bottom:5px; display:block; }
a { color:#4caf50; text-decoration:none; display:block; margin-top:20px; text-align:center; }
</style>
</head>
<body>

<h1 id="dayTitle">Trackers</h1>
<a href="calendar.html">⬅ Back to Calendar</a>
<div id="dayTracks"></div>

<script>
// --- Get date from query ---
const params = new URLSearchParams(window.location.search);
const dateStr = params.get("date");

// --- Validate date ---
if(!dateStr){
  document.getElementById("dayTitle").innerText = "No date selected";
}

// --- Load tracks ---
let tracks = JSON.parse(localStorage.getItem("tracks")) || [];

// --- Ensure history for the selected date ---
tracks.forEach(t=>{
  if(!t.history) t.history = {};
  if(t.history[dateStr] === undefined){
    t.history[dateStr] = t.type==="amount" ? 0 : t.done || false;
  }
});

const container = document.getElementById("dayTracks");
const todayDate = new Date();
const todayStr = todayDate.getFullYear() + '-' +
                 String(todayDate.getMonth()+1).padStart(2,'0') + '-' +
                 String(todayDate.getDate()).padStart(2,'0');

if(dateStr) {
  document.getElementById("dayTitle").innerText = `Trackers for ${dateStr}`;
}

tracks.forEach(t=>{
  const card = document.createElement("div");
  card.className = "card";

  let val = t.history[dateStr];

  // Future dates: show empty
  if(dateStr > todayStr) {
    card.innerHTML = `<strong>${t.name}</strong><div style="opacity:0.5">—</div>`;
    container.appendChild(card);
    return;
  }

  if(t.type === "amount"){
    if(val >= t.goal) card.innerHTML = `<strong>${t.name}</strong><div class="green">${val}/${t.goal}</div>`;
    else if(val > 0) card.innerHTML = `<strong>${t.name}</strong><div class="yellow">${val}/${t.goal}</div>`;
    else card.innerHTML = `<strong>${t.name}</strong><div class="red">0/${t.goal}</div>`;
  } else {
    // boolean trackers: treat any truthy value as done
    if(val) card.innerHTML = `<strong>${t.name}</strong><div class="green">✅ Completed</div>`;
    else card.innerHTML = `<strong>${t.name}</strong><div class="red">❌ Not Done</div>`;
  }

  container.appendChild(card);
});
</script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js')
    .then(() => console.log('Service Worker Registered'));
}
</script>

</body>
</html>
